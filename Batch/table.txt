CREATE KEYSPACE FLASHBACK  WITH replication = {'class': 'SimpleStrategy', 'replication_factor' : 3};

USE FLASHBACK;

# Time Machine
CREATE TABLE FIRSTPOST  (author text,
created_utc bigint, body text,
link_id text, subreddit text,
PRIMARY KEY (author,created_utc))with clustering order by (created_utc asc);


CREATE TABLE SUBREDDITINFO ( total_comments int ,
distinct_authors int,
distinct_submissions int ,
comments_per_distinct_author double,
comments_per_distinct_submission double,
PRIMARY KEY(subreddit));






SELECT subreddit, COUNT(*) total_comments, count(DISTINCT author) distinct_authors, count(DISTINCT link_id)     distinct_submissions, (COUNT(*) / count(DISTINCT author)) comments_per_distinct_author, (COUNT(*)/ count(DISTINCT link_id))     comments_per_distinct_submission
FROM comments
GROUP BY subreddit
ORDER BY total_comments DESC
